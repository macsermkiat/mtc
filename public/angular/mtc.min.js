(function(){angular.module("mtcApp").factory("mtcData",e);e.$inject=["$http","$log"];function e(e,t){var o=function(t){return e.get("/api/coaches/search/?text="+t)};var n=function(){return e.get("/api/allcoaches")};var r=function(){return e.get("/api/allcats")};var a=function(t){return e.post("/api/request",t)};var i=function(t){return e.get("/api/coaches/"+t)};var c=function(t){return e.get("/api/user/"+t)};function s(t){return e.post("/api/coaches",t).then(function(e){return e.data})}function u(t){return e.delete("/api/coaches/"+t)}var l=function(t){return e.post("/api/newsletter",t).then(function(e){return e.news})};return{allCoaches:n,allCats:r,coachById:i,userById:c,createCoach:s,deleteCoach:u,addNewsLetter:l,searchCategoryService:o,requestCoach:a}}})();(function(){angular.module("mtcApp").factory("userService",e);e.$inject=["$http","$log","$window"];function e(e,t,o){var n=function(){return o.localStorage["id_token"]};function r(t){return e.post("/api/users/create",t).then(function(e){return e.data})}function a(t){return e.put("/api/users/update",t).then(function(e){return e.data})}function i(t){return e.put("/api/coachEdit/update",t).then(function(e){return e.data})}return{getToken:n,registerUser:r,updateUser:a,updateCoach:i}}})();(function(){"use strict";angular.module("mtcApp").service("authService",e);e.$inject=["$timeout","$rootScope","lock","authManager","$http","$location","$state","$window"];function e(e,t,o,n,r,a,i,c){var s=JSON.parse(localStorage.getItem("profile"))||{};var u=JSON.parse(localStorage.getItem("subscription"))||{};function l(){return s}function f(e){s=e}function m(){return u}function d(e){u=e}function p(){o.show()}function g(){localStorage.removeItem("id_token");localStorage.removeItem("profile");localStorage.removeItem("subscription");n.unauthenticate();s={};i.go("/");c.location.reload()}function h(){var e=localStorage.getItem("profile");var o=angular.fromJson(e);var n=o.identities[0].user_id;console.log(n);a(n);function a(e){return r.get("/api/user/"+e).then(function(e){var o=e.data[0];console.log(o);if(o==undefined){localStorage.setItem("subscription",false);t.isSubscribed=false}else{localStorage.setItem("subscription",true);t.isSubscribed=true}},function(e){if(err){console.log(e)}})}}function v(){o.on("authenticated",function(r){localStorage.setItem("id_token",r.idToken);n.authenticate();o.getProfile(r.idToken,function(o,n){if(o){console.log(o)}else{localStorage.setItem("profile",JSON.stringify(n));f(n);h();e(function(){i.go("/")},100);t.$broadcast("userProfileSet",n);t.$broadcast("subscriptionSet",u)}})})}return{getUserProfile:l,userProfile:s,userSubscription:u,login:p,logout:g,registerAuthenticationListener:v}}})();(function(){angular.module("mtcApp").controller("homeCtrl",e);e.$inject=["$state","mtcData","$timeout"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o){var n=this;n.message={};n.onNewsLetter=function(){n.Error="";if(!n.formLetter.email){n.Error="Email required, please try again";return false}else{n.doAddNewsLetter(n.formLetter)}n.message.success=true;o(function(){n.message.success=false},3e3)};n.doAddNewsLetter=function(e){console.log(e);t.addNewsLetter({name:e.name,email:e.email})}}})();(function(){angular.module("mtcApp").controller("requestModalCtrl",e);e.$inject=["$uibModalInstance","mtcData","coachData","$timeout"];function e(e,t,o,n){var r=this;r.coachData=o;var a=new Date;var i=localStorage.getItem("profile");var c=angular.fromJson(i);var s=c.identities[0].user_id;var u=s+":"+a.toISOString();r.onSubmit=function(){r.formError="";if(!r.formData.time||!r.formData.place||!r.formData.phone||!r.formData.email){r.formError="All fields required, please try again";return false}else{var e=r.formData;r.doRequest(e)}};r.doRequest=function(e){console.log(o.coachid);t.requestCoach({requestid:u,shortDescription:o.shortDescription,coachid:o.coachid,createdBy:o.createdBy,price:o.price,identity:s,time:e.time,place:e.place,phone:e.phone,email:e.email}).then(function(e){console.log(e);r.formError="Your request has been sent";r.uibModal.close(e)},function(e){r.formError="Your request has not been sent, try again"})};r.uibModal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("mtcApp").component("ngInitial",function(){return{restrict:"A",controller:["$scope","$element","$attr","$parse",function(e,t,o,n){var r,a,i;i=o.ngInitial||o.value||t.text();r=n(o.ngModel);a=r.assign;a(e,i)}]}})})();(function(){angular.module("mtcApp").controller("profileController",e);e.$inject=["$stateParams","$state","$http","userService","mtcData"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n,r){var a;var i=function(){if(!localStorage.getItem("profile")){alert("Please Log in");t.go("home")}else{a=localStorage.getItem("profile");return a}};i();var c=angular.fromJson(a);var s=c.identities[0].user_id;var u=this;u.profile=c;u.result="";function l(){r.userById(s).then(function(e){if(e){u.data={coach:e};u.result=u.data.coach.data[0]}else{console.log("Something wrong")}},function(e){console.log(e)})}l()}})();(function(){angular.module("mtcApp").controller("profileCoursesController",e);e.$inject=["$state","$http","mtcData"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o){var n;var r=function(){if(!localStorage.getItem("profile")){alert("Please Log in");e.go("home")}else{n=localStorage.getItem("profile");return n}};r();var a=angular.fromJson(n);var i=a.identities[0].user_id;var c=this;function s(e){return t.get("/api/users/course",{params:{id:e}}).then(function(e){return e.data})}function u(){return s(i).then(function(e,t){if(t){console.log(t)}else{c.data={coach:e}}})}u();c.deleteCourse=function(t,n){if(confirm("Are you sure to delete "+n+"?")==true){o.deleteCoach(t).then(function(t){console.log("Delete");e.go("profile.bio")},function(e){console.log("error: "+e)})}else{return false}}}})();(function(){angular.module("mtcApp").controller("profileBioController",e);e.$inject=["$stateParams","$http"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t){var o=this;var n=localStorage.getItem("profile");var r=angular.fromJson(n);var a=r.identities[0].user_id;o.profile=r;function i(e){return t.get("/api/users/bio",{params:{id:e}}).then(function(e){return e.data})}function c(){return i(a).then(function(e,t){if(t){console.log(t)}else{o.data={coach:e}}})}c()}})();(function(){angular.module("mtcApp").controller("profileEditController",e);e.$inject=["$scope","userService","$state","$timeout","awsPolicy","$http"];function e(e,t,o,n,r,a){var i=r.getSign();console.log(i);var c=localStorage.getItem("profile");var s=angular.fromJson(c);var u=s.identities[0].user_id;var l=s.identities[0].user_id;e.message={};e.isDisabled=false;e.onSubmit=function(){e.formError="";if(!e.user.result.name||!e.user.result.surname||!e.user.result.email||!e.user.result.idnumber||!e.user.result.telephone){e.formError="All fields required, please try again";return false}else{var t=e.user.result;e.doEdit(t)}};var f=new Date;e.doEdit=function(r){t.updateUser({memberSince:f,identity:u,name:r.name,surname:r.surname,email:r.email,picture:s.picture,address:r.address,experience:r.experience,telephone:r.telephone,lineid:r.lineid,idnumber:r.idnumber,education:r.education,term:r.term}).then(function(t){e.message.success=true;n(function(){e.message.success=false},2e3);localStorage.setItem("subscription",true);n(function(){o.go("profile.bio")},2e3)},function(t){var o=Object.keys(t).map(function(e){return t[e]});console.log(o[0].message);e.formError="Your edit has not been saved, try again. Possible from duplicate data."});return false};e.resetForm=function(){e.subscription.$setPristine()}}})();(function(){angular.module("mtcApp").controller("coachEditCtrl",e);e.$inject=["$stateParams","$http","mtcData","userService","$log","$scope","$state","$timeout","Upload","awsPolicy","spinnerService"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n,r,a,i,c,s,u,l){var f=this;f.coachid=e.coachid;var m=u.getSign();console.log(m);var d=localStorage.getItem("profile");var p=angular.fromJson(d);var g=p.identities[0].user_id;f.message={};f.isDisabled=false;f.onSubmit=function(){f.formError="";if(!f.formData.name||!f.formData.subject||!f.formData.price||!f.formData.shortDescription||!f.formData.courseDescription||!f.formData.time||!f.formData.location||!f.formData.category){f.formError="All fields required, please try again";return false}else{var e=f.formData;f.doEdit(e);f.isDisabled=true;f.message.success=true;c(function(){f.message.success=false},1e3).then(function(e){if(e){console.log(error);f.formError="Your review has not been saved, try again"}else{console.log("YES!")}});i.go("profile.courses")}};h();function h(){return v().then(function(){r.info("View coach by ID")})}function v(){return o.coachById(f.coachid).success(function(e){if(e){f.formData=e}else{console.log("Error: no coachid found")}console.log(f.data)}).error(function(e){console.log(e)})}f.doEdit=function(e){n.updateCoach({createdDate:w,coachid:f.coachid,name:e.name,price:e.price,subject:e.subject,shortDescription:e.shortDescription,courseDescription:e.courseDescription,preparation:e.preparation,group:e.group,time:e.time,courseLength:e.courseLength,level:e.level,location:e.location,category:e.category,videoid:e.videoid});return false};f.resetForm=function(){a.subscription.$setPristine()};var S=new Date;var w=S.toISOString();console.log(w);a.beforeResizingImages=function(e){l.show("picturespinner")};a.afterResizingImages=function(e){l.hide("picturespinner")};a.uploadPic=function(e){Promise.resolve(m).then(function(e){return e}).then(function(t){e.upload=s.upload({url:"https://matchthecoach.s3.amazonaws.com",method:"POST",data:{key:"coaches/"+w,AWSAccessKeyId:t.s3AccessKeyId,acl:"public-read",policy:t.s3Policy,signature:t.s3Signature,"Content-Type":e.type!=""?e.type:"application/octet-stream",filename:e.name,file:e}})}).then(function(){e.upload.then(function(t){c(function(){e.result=t.data})},function(e){if(e.status>0)f.errorMsg=e.status+":"+e.data},function(t){e.progress=Math.min(100,parseInt(100*t.loaded/t.total))})})};function b(){return o.allCats().success(function(e){f.data={cat:e}}).error(function(e){f.message="Sorry, something's gone wrong"})}b()}})();(function(){angular.module("mtcApp").controller("subscriptionCtrl",e);e.$inject=["userService","$state","$timeout","$window","Upload","$scope","awsPolicy","mtcData"];function e(e,t,o,n,r,a,i,c){var s=this;var u=i.getSign();console.log(u);var l=localStorage.getItem("profile");var f=angular.fromJson(l);var m=f.identities[0].user_id;s.message={};s.isDisabled=false;s.onSubmit=function(){s.formError="";if(!s.formData.name||!s.formData.surname||!s.formData.email||!s.formData.idnumber||!s.formData.telephone){s.formError="All fields required, please try again";return false}else{var e=s.formData;s.doSubscription(e)}};var d=new Date;s.doSubscription=function(r){console.log(r);e.registerUser({memberSince:d,identity:m,name:r.name,surname:r.surname,email:r.email,picture:f.picture,address:r.address,experience:r.experience,telephone:r.telephone,lineid:r.lineid,idnumber:r.idnumber,education:r.education,terms:r.terms}).then(function(e){s.doAddNewsLetter(r);s.isDisabled=true;s.message.success=true;o(function(){s.message.success=false},2e3);localStorage.setItem("subscription",true);o(function(){t.go("/")},2e3);o(function(){n.location.reload()},2500)},function(e){var t=Object.keys(e).map(function(t){return e[t]});console.log(t[0].message);s.formError="Your edit has not been saved, try again. Possible from duplicate data."});return false};s.resetForm=function(){s.subscription.$setPristine()};s.doAddNewsLetter=function(e){console.log(e);c.addNewsLetter({name:e.name,email:e.email})}}})();(function(){angular.module("mtcApp").controller("searchCtrl",e);e.$inject=["$stateParams","$http","mtcData","$log"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n){var r=this;r.text=e.text;a();function a(){return i().then(function(){n.info("Search coaches by keyword.")})}function i(){return o.searchCategoryService(r.text).success(function(e){r.data={coach:e}}).error(function(e){r.message="Sorry, something's gone wrong"})}}})();(function(){angular.module("mtcApp").controller("coachDetailCtrl",e);e.$inject=["$stateParams","$http","mtcData","$log","$scope","$uibModal","$rootScope"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n,r,a,i){var c=this;c.coachid=e.coachid;r.playerVars={autoplay:0};r.vdo=null;s();function s(){return u().then(function(){n.info("View coach by ID")})}function u(){return o.coachById(c.coachid).success(function(e){if(e){c.data={coach:e};r.videoid=e.videoid;r.vdo=true}else{r.vdo=false}console.log(c.data)}).error(function(e){console.log(e)})}c.popupRequestForm=function(){if(i.isAuthenticated===true){var e=a.open({templateUrl:"/common/request/requestModal.view.html",controller:"requestModalCtrl",controllerAs:"vm",resolve:{coachData:function(){return{coachid:c.coachid,shortDescription:c.data.coach.shortDescription,createdBy:c.data.coach.createdBy,price:c.data.coach.price}}}});e.result.then(function(e){console.log(e)})}else{alert("Please log in to continue");return false}}}})();(function(){angular.module("mtcApp").controller("userDetailController",e);e.$inject=["$stateParams","$http","mtcData"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o){var n=this;var r=e.userid;n.teacher="";function a(){o.userById(r).then(function(e){if(e){n.data={coach:e};n.teacher=n.data.coach.data[0]}else{console.log("Something wrong")}},function(e){console.log(e)})}a()}})();(function(){angular.module("mtcApp").controller("addCoachCtrl",e);e.$inject=["mtcData","$state","$timeout","Upload","$scope","awsPolicy","spinnerService"];function e(e,t,o,n,r,a,i){var c=this;var s=a.getSign();console.log(s);var u=localStorage.getItem("profile");var l=angular.fromJson(u);var f=l.identities[0].user_id;c.message={};c.isDisabled=false;c.onSubmit=function(){c.formError="";if(!c.formData.name||!c.formData.subject||!c.formData.price||!c.formData.shortDescription||!c.formData.courseDescription||!c.formData.time||!c.formData.location||!c.formData.category){c.formError="All fields required, please try again";return false}else{var e=c.formData;c.doAddCoach(e)}};var m=new Date;var d=m.toISOString();console.log(d);c.doAddCoach=function(n){console.log(n);e.createCoach({createdDate:d,name:n.name,price:n.price,subject:n.subject,shortDescription:n.shortDescription,courseDescription:n.courseDescription,preparation:n.preparation,group:n.group,time:n.time,courseLength:n.courseLength,level:n.level,location:n.location,category:n.category,videoid:n.videoid,createdBy:f}).then(function(e){c.isDisabled=true;c.message.success=true;o(function(){c.message.success=false},2e3);o(function(){t.go("/")},2e3)},function(e){var t=Object.keys(e).map(function(t){return e[t]});console.log(t[0].message);r.formError="Your course has not been added, try again. Possible from duplicate data."});return false};c.resetForm=function(){c.addCoach.$setPristine()};r.beforeResizingImages=function(e){i.show("picturespinner")};r.afterResizingImages=function(e){i.hide("picturespinner")};r.uploadPic=function(e){Promise.resolve(s).then(function(e){return e}).then(function(t){e.upload=n.upload({url:"https://matchthecoach.s3.amazonaws.com",method:"POST",data:{key:"coaches/"+d,AWSAccessKeyId:t.s3AccessKeyId,acl:"public-read",policy:t.s3Policy,signature:t.s3Signature,"Content-Type":e.type!=""?e.type:"application/octet-stream",filename:e.name,file:e}})}).then(function(){e.upload.then(function(t){o(function(){e.result=t.data})},function(e){if(e.status>0)c.errorMsg=e.status+":"+e.data},function(t){e.progress=Math.min(100,parseInt(100*t.loaded/t.total))})})};function p(){return e.allCats().success(function(e){c.data={cat:e}}).error(function(e){c.message="Sorry, something's gone wrong"})}p()}})();(function(){angular.module("mtcApp").component("navigation",{restrict:"EA",templateUrl:"/common/navigationAndfooter/navigation.template.html",controller:"loginController",controllerAs:"lgin"})})();(function(){angular.module("mtcApp").component("footerGeneric",{templateUrl:"/common/navigationAndfooter/footerGeneric.template.html"})})();(function(){angular.module("mtcApp").controller("SearchBoxController",e);e.$inject=["$state","mtcData","$timeout","$http"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n){var r=this;r.text="";r.onSubmit=function(t){if(r.text!==""){e.go("search",{text:r.text})}};r.searching=function(e){return n.get("api/coaches/searchCat",{params:{text:e}}).then(function(e){console.log(e.data);return e.data})};a();function a(){return t.allCats().success(function(e){r.data={cat:e}}).error(function(e){r.message="Sorry, something's gone wrong"})}r.addModel=function(e){r.text=e}}})();(function(){angular.module("mtcApp").component("searchbox",{restrict:"E",templateUrl:"/common/searchbox/searchbox.template.html",bindings:{text:"<"},controller:"SearchBoxController",controllerAs:"vm"})})();(function(){angular.module("mtcApp").factory("awsPolicy",e);e.$inject=["$http","$log"];function e(e,t){var o=function(){return e.get("/api/awsPolicy").then(function(e){return e.data})};return{getSign:o}}})();(function(){angular.module("mtcApp").controller("loginController",e);e.$inject=["authService","$translate","$rootScope","$scope","$state","$timeout"];function e(e,t,o,n,r,a){var i=this;i.authService=e;i.changeLanguage=function(e){t.use(e)};i.getSubscription=o.isSubscribed;i.serviceSubscription=o.authService.userSubscription;i.isAuthenticated=o.isAuthenticated;a(function(){i.getSubscription=o.isSubscribed;console.log("Subscription form fill: "+i.getSubscription)},1e3);o.$on("userProfileSet",function(e,t){i.isAuthenticated=o.isAuthenticated;i.profile=t});o.$on("subscriptionSet",function(e,t){a(function(){i.getSubscription=o.isSubscribed;console.log("Subscription form fill: "+i.getSubscription)},1e3)});var c=localStorage.getItem("profile");if(c){i.profile=angular.fromJson(c)}var s=new Auth0Lock("2m8hbwYC8UdyjITdKGDptrRvF6BXweY7","royyak.auth0.com");s.on("authenticated",function(e){s.getProfile(e.idToken,function(t,o){console.log(e.idToken);if(t){console.log(t);return}if(o){localStorage.setItem("id_token",e.idToken);localStorage.setItem("profile",JSON.stringify(profile))}return})});i.addCoach=function(e){if(e=true){r.go("addCoach")}else{return false}}}})();