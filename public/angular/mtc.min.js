(function(){angular.module("mtcApp").factory("mtcData",e);e.$inject=["$http","$log"];function e(e,t){var o=function(t){return e.get("/api/coaches/search/?text="+t)};var n=function(){return e.get("/api/allcoaches")};var r=function(){return e.get("/api/allcats")};var a=function(t){return e.post("/api/request",t)};var i=function(t){return e.get("/api/coaches/"+t)};var c=function(t){return e.get("/api/user/"+t)};function s(t){return e.post("/api/coaches",t).then(function(e){return e.data})}function u(t){return e.delete("/api/coaches/"+t)}var l=function(t){return e.post("/api/newsletter",t).then(function(e){return e.news})};var f=function(t){return e.post("/api/sendNews",t).then(function(e){return e.mail})};return{allCoaches:n,allCats:r,coachById:i,userById:c,createCoach:s,deleteCoach:u,addNewsLetter:l,sendFirstLetter:f,searchCategoryService:o,requestCoach:a}}})();(function(){angular.module("mtcApp").factory("userService",e);e.$inject=["$http","$log","$window"];function e(e,t,o){var n=function(){return o.localStorage["id_token"]};function r(t){return e.post("/api/users/create",t).then(function(e){return e.data})}function a(t){return e.put("/api/users/update",t).then(function(e){return e.data})}function i(t){return e.put("/api/coachEdit/update",t).then(function(e){return e.data})}return{getToken:n,registerUser:r,updateUser:a,updateCoach:i}}})();(function(){"use strict";angular.module("mtcApp").service("authService",e);e.$inject=["$timeout","$rootScope","lock","authManager","$http","$location","$state","$window"];function e(e,t,o,n,r,a,i,c){var s=JSON.parse(localStorage.getItem("profile"))||{};var u=JSON.parse(localStorage.getItem("subscription"))||{};function l(){return s}function f(e){s=e}function m(){return u}function d(e){u=e}function p(){o.show()}function g(){localStorage.removeItem("id_token");localStorage.removeItem("profile");localStorage.removeItem("subscription");n.unauthenticate();s={};i.go("/");c.location.reload()}function h(){var e=localStorage.getItem("profile");var o=angular.fromJson(e);var n=o.identities[0].user_id;a(n);function a(e){return r.get("/api/user/"+e).then(function(e){var o=e.data[0];if(o==undefined){localStorage.setItem("subscription",false);t.isSubscribed=false}else{localStorage.setItem("subscription",true);t.isSubscribed=true}},function(e){if(err){console.log(e)}})}}function v(){o.on("authenticated",function(r){localStorage.setItem("id_token",r.idToken);n.authenticate();o.getProfile(r.idToken,function(o,n){if(o){console.log(o)}else{localStorage.setItem("profile",JSON.stringify(n));f(n);h();e(function(){i.go("profile.bio")},100);t.$broadcast("userProfileSet",n);t.$broadcast("subscriptionSet",u)}})})}return{getUserProfile:l,userProfile:s,userSubscription:u,login:p,logout:g,registerAuthenticationListener:v}}})();(function(){angular.module("mtcApp").controller("homeCtrl",e);e.$inject=["$state","mtcData","$timeout","$uibModal","$rootScope"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n,r){var a=this;a.message={};a.isAuthenticated=r.isAuthenticated;a.onNewsLetter=function(){a.Error="";if(!a.formLetter.email){a.Error="Email required, please try again";return false}else{a.doAddNewsLetter(a.formLetter)}a.message.success=true;o(function(){a.message.success=false},3e3)};a.doAddNewsLetter=function(e){t.addNewsLetter({name:e.name,email:e.email})};a.popupEmailForm=function(){var e=n.open({templateUrl:"/home/email/emailModal.view.html",controller:"emailModalController",controllerAs:"vm"});e.result.then(function(e){console.log(e)})}}})();(function(){angular.module("mtcApp").controller("emailModalController",e);e.$inject=["$uibModalInstance","mtcData","$timeout"];function e(e,t,o){var n=this;n.onSubmit=function(){n.formError="";n.forSuccess="";if(!n.formLetter.role||!n.formLetter.email){n.formError="All fields required, please try again";return false}else{var e=n.formLetter;n.doRequest(e);n.sendFreeCoupon(e)}};n.sendFreeCoupon=function(e){t.sendFirstLetter({email:e.email}).then(function(e){console.log("Your coupon was deliverec to"+email)},function(e){console.log("Something went wrong: "+e)})};n.doRequest=function(e){t.addNewsLetter({role:e.role,email:e.email}).then(function(e){n.formSuccess="Thank you. We will send you a discount code via Email soon";o(function(){n.uibModal.close(e)},3e3)},function(e){n.formError="Your request has not been sent, possible from duplicate Email"})};n.uibModal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("mtcApp").controller("requestModalCtrl",e);e.$inject=["$uibModalInstance","mtcData","coachData","$timeout"];function e(e,t,o,n){var r=this;r.coachData=o;var a=new Date;var i=localStorage.getItem("profile");var c=angular.fromJson(i);var s=c.identities[0].user_id;var u=c.name;var l=s+":"+a.toISOString();r.success=false;r.isDisabled=false;r.onSubmit=function(){r.formError="";if(!r.formData.time||!r.formData.place||!r.formData.phone||!r.formData.email||!r.formData.sex){r.formError="All fields required, please try again";return false}else{var e=r.formData;r.doRequest(e)}};r.doRequest=function(e){r.success=true;r.isDisabled=true;t.requestCoach({requestid:l,shortDescription:o.shortDescription,coachid:o.coachid,createdBy:o.createdBy,price:o.price,identity:s,nameOfStudent:u,time:e.time,place:e.place,phone:e.phone,email:e.email,sex:e.sex}).then(function(e){r.uibModal.close(e)},function(e){r.formError="Your request has not been sent, try again"})};r.uibModal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("mtcApp").component("ngInitial",function(){return{restrict:"A",controller:["$scope","$element","$attr","$parse",function(e,t,o,n){var r,a,i;i=o.ngInitial||o.value||t.text();r=n(o.ngModel);a=r.assign;a(e,i)}]}})})();(function(){angular.module("mtcApp").controller("profileController",e);e.$inject=["$stateParams","$state","$http","userService","mtcData"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n,r){var a;var i=function(){if(!localStorage.getItem("profile")){alert("Please Log in");t.go("home")}else{a=localStorage.getItem("profile");return a}};i();var c=angular.fromJson(a);var s=c.identities[0].user_id;var u=this;u.profile=c;u.result="";var l=localStorage.getItem("subscription");u.subscription=l==="true";function f(){r.userById(s).then(function(e){if(e){u.data={coach:e};u.result=u.data.coach.data[0]}else{console.log("Something wrong")}},function(e){console.log(e)})}f()}})();(function(){angular.module("mtcApp").controller("profileCoursesController",e);e.$inject=["$state","$http","mtcData","$filter"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n){var r;var a;var i=function(){if(!localStorage.getItem("profile")){alert("Please Log in");e.go("home")}else{r=localStorage.getItem("profile");subscription=localStorage.getItem("subscription");return r}};i();var c=angular.fromJson(r);var s=c.identities[0].user_id;var u=this;u.subscription=subscription;var l=localStorage.getItem("subscription");u.subscription=l==="true";function f(e){return t.get("/api/users/course",{params:{id:e}}).then(function(e){return e.data})}function m(){return f(s).then(function(e,t){if(t){console.log(t)}else{u.data={coach:e}}})}m();u.deleteCourse=function(t,n){if(confirm("Are you sure to delete "+n+"?")==true){o.deleteCoach(t).then(function(t){console.log("Delete");e.go("profile.bio")},function(e){console.log("error: "+e)})}else{return false}};u.addCoach=function(){var t=localStorage.getItem("subscription");if(t=="false"){alert(n("translate")("PROFILE.ALERT"));e.go("subscription")}else if(t=="true"){e.go("addCoach")}}}})();(function(){angular.module("mtcApp").controller("profileBioController",e);e.$inject=["$stateParams","$http"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t){var o=this;var n=localStorage.getItem("profile");var r=angular.fromJson(n);var a=r.identities[0].user_id;o.profile=r;function i(e){return t.get("/api/users/bio",{params:{id:e}}).then(function(e){return e.data})}function c(){return i(a).then(function(e,t){if(t){console.log(t)}else{o.data={coach:e}}})}c()}})();(function(){angular.module("mtcApp").controller("profileEditController",e);e.$inject=["$scope","userService","$state","$timeout","awsPolicy","$http"];function e(e,t,o,n,r,a){var i=r.getSign();var c=localStorage.getItem("profile");var s=angular.fromJson(c);var u=s.identities[0].user_id;var l=s.identities[0].user_id;e.message={};e.onSubmit=function(){e.formError="";if(!e.user.result.name||!e.user.result.surname||!e.user.result.email||!e.user.result.idnumber||!e.user.result.telephone){e.formError="All fields required, please try again";return false}else{var t=e.user.result;e.doEdit(t)}};var f=new Date;e.doEdit=function(r){t.updateUser({memberSince:f,identity:u,name:r.name,surname:r.surname,email:r.email,picture:s.picture,address:r.address,experience:r.experience,telephone:r.telephone,lineid:r.lineid,idnumber:r.idnumber,education:r.education,term:r.term}).then(function(t){e.message.success=true;n(function(){e.message.success=false},2e3);localStorage.setItem("subscription",true);n(function(){o.go("profile.bio")},2e3)},function(t){var o=Object.keys(t).map(function(e){return t[e]});e.formError="Your edit has not been saved, try again. Possible from duplicate data."});return false};e.resetForm=function(){e.subscription.$setPristine()}}})();(function(){angular.module("mtcApp").controller("coachEditCtrl",e);e.$inject=["$stateParams","$http","mtcData","userService","$log","$scope","$state","$timeout","Upload","awsPolicy","spinnerService"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n,r,a,i,c,s,u,l){var f=this;f.coachid=e.coachid;var m=u.getSign();var d=localStorage.getItem("profile");var p=angular.fromJson(d);var g=p.identities[0].user_id;f.message={};f.isDisabled=false;f.onSubmit=function(){f.formError="";if(!f.formData.name||!f.formData.subject||!f.formData.price||!f.formData.shortDescription||!f.formData.courseDescription||!f.formData.time||!f.formData.province||!f.formData.location||!f.formData.category||!f.formData.courseLength){f.formError="All fields required, please try again";return false}else{var e=f.formData;f.doEdit(e);f.isDisabled=true;f.message.success=true;c(function(){f.message.success=false},1e3).then(function(e){if(e){console.log(error);f.formError="Your edit has not been saved, try again"}else{console.log("YES!")}});i.go("profile.courses")}};h();function h(){return v().then(function(){r.info("View coach by ID")})}function v(){return o.coachById(f.coachid).success(function(e){if(e){f.formData=e}else{console.log("Error: no coachid found")}console.log("Success")}).error(function(e){console.log(e)})}f.doEdit=function(e){n.updateCoach({createdDate:S,coachid:f.coachid,name:e.name,price:e.price,subject:e.subject,shortDescription:e.shortDescription,courseDescription:e.courseDescription,preparation:e.preparation,group:e.group,time:e.time,courseLength:e.courseLength,level:e.level,location:e.location,province:e.province,category:e.category,videoid:e.videoid});return false};f.resetForm=function(){a.subscription.$setPristine()};var b=new Date;var S=b.toISOString();a.beforeResizingImages=function(e){l.show("picturespinner")};a.afterResizingImages=function(e){l.hide("picturespinner")};a.uploadPic=function(e){var t=s.dataUrltoBlob(e,name);var o=new File([t],"1.jpg");e=o;alert("เมื่อ upload หรือเปลี่ยนรูปใหม่เสร็จ ต้องทำการ submit แบบฟอร์มทั้งหมดที่ปุ่ม Submit ด้านล่างสุดบรรทัดสุดท้ายด้วยทุกครั้ง\nEverytime you finish upload or change the new picture. Please submit the whole form via the button beneath last line");Promise.resolve(m).then(function(e){return e}).then(function(t){e.upload=s.upload({url:"https://matchthecoach.s3.amazonaws.com",method:"POST",data:{key:"coaches/"+S,AWSAccessKeyId:t.s3AccessKeyId,acl:"public-read",policy:t.s3Policy,signature:t.s3Signature,"Content-Type":e.type!=""?e.type:"image/png",filename:o.name,file:e}})}).then(function(){e.upload.then(function(e){c(function(){f.result=e.data})},function(e){if(e.status>0)f.errorMsg=e.status+":"+e.data},function(e){f.progress=Math.min(100,parseInt(100*e.loaded/e.total))})})};function w(){return o.allCats().success(function(e){f.data={cat:e}}).error(function(e){f.message="Sorry, something's gone wrong"})}w()}})();(function(){angular.module("mtcApp").controller("subscriptionCtrl",e);e.$inject=["userService","$state","$timeout","$window","Upload","$scope","awsPolicy","mtcData"];function e(e,t,o,n,r,a,i,c){var s=this;var u=i.getSign();var l=localStorage.getItem("profile");var f=angular.fromJson(l);var m=f.identities[0].user_id;s.message={};s.isDisabled=false;s.onSubmit=function(){s.formError="";if(!s.formData.name||!s.formData.surname||!s.formData.email||!s.formData.idnumber||!s.formData.telephone){s.formError="All fields required, please try again";return false}else{var e=s.formData;s.doSubscription(e)}};var d=new Date;s.doSubscription=function(r){e.registerUser({memberSince:d,identity:m,name:r.name,surname:r.surname,email:r.email,picture:f.picture,address:r.address,experience:r.experience,telephone:r.telephone,lineid:r.lineid,idnumber:r.idnumber,education:r.education,terms:r.terms,role:r.role}).then(function(e){s.doAddNewsLetter(r);s.isDisabled=true;s.message.success=true;o(function(){s.message.success=false},2e3);localStorage.setItem("subscription",true);o(function(){t.go("/")},2e3);o(function(){n.location.reload()},2500)},function(e){var t=Object.keys(e).map(function(t){return e[t]});s.formError="Your edit has not been saved, try again. Possible from duplicate data."});return false};s.resetForm=function(){s.subscription.$setPristine()};s.doAddNewsLetter=function(e){c.addNewsLetter({name:e.name,email:e.email,role:e.role})}}})();(function(){angular.module("mtcApp").controller("searchCtrl",e);e.$inject=["$stateParams","$http","mtcData","$log"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n){var r=this;r.text=e.text;a();function a(){return i().then(function(){n.info("Search coaches by keyword.")})}function i(){return o.searchCategoryService(r.text).success(function(e){r.data={coach:e}}).error(function(e){r.message="Sorry, something's gone wrong"})}}})();(function(){angular.module("mtcApp").controller("coachDetailCtrl",e);e.$inject=["$stateParams","$http","mtcData","$log","$scope","$uibModal","$rootScope","$state"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n,r,a,i,c){var s=this;s.coachid=e.coachid;r.playerVars={autoplay:0};r.vdo=null;l();function u(){var e=document.querySelector(".js-textareacopybtn");e.addEventListener("click",function(e){var t=document.querySelector(".js-copytextarea");t.select();try{var o=document.execCommand("copy");var n=o?"successful":"unsuccessful";console.log("Copying text command was "+n)}catch(e){console.log("Oops, unable to copy")}})}u();function l(){return f().then(function(){n.info("View coach by ID")})}function f(){return o.coachById(s.coachid).success(function(e){if(e){s.data={coach:e};r.videoid=e.videoid;r.vdo=true}else{r.vdo=false}}).error(function(e){console.log(e)})}s.popupRequestForm=function(){if(i.isAuthenticated===true){var e=a.open({templateUrl:"/common/request/requestModal.view.html",controller:"requestModalCtrl",controllerAs:"vm",resolve:{coachData:function(){return{coachid:s.coachid,shortDescription:s.data.coach.shortDescription,createdBy:s.data.coach.createdBy,price:s.data.coach.price}}}});e.result.then(function(e){console.log(e)})}else{alert("Please log in to continue");return false}}}})();(function(){angular.module("mtcApp").controller("userDetailController",e);e.$inject=["$stateParams","$http","mtcData"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o){var n=this;var r=e.userid;n.teacher="";function a(){o.userById(r).then(function(e){if(e){n.data={coach:e};n.teacher=n.data.coach.data[0]}else{console.log("Something wrong")}},function(e){console.log(e)})}a()}})();(function(){angular.module("mtcApp").controller("addCoachCtrl",e);e.$inject=["mtcData","$state","$timeout","Upload","$scope","awsPolicy","spinnerService"];function e(e,t,o,n,r,a,i){var c=this;var s=a.getSign();var u=localStorage.getItem("profile");var l=angular.fromJson(u);var f=l.identities[0].user_id;c.message={};c.isDisabled=false;c.onSubmit=function(){c.formError="";if(!c.formData.name||!c.formData.subject||!c.formData.price||!c.formData.shortDescription||!c.formData.courseDescription||!c.formData.time||!c.formData.province||!c.formData.location||!c.formData.category||!c.formData.courseLength){c.formError="All fields required, please try again";return false}else{var e=c.formData;c.doAddCoach(e)}};var m=new Date;var d=m.toISOString();c.doAddCoach=function(n){e.createCoach({createdDate:d,name:n.name,price:n.price,subject:n.subject,shortDescription:n.shortDescription,courseDescription:n.courseDescription,preparation:n.preparation,group:n.group,time:n.time,courseLength:n.courseLength,level:n.level,location:n.location,province:n.province,category:n.category,videoid:n.videoid,createdBy:f}).then(function(e){c.isDisabled=true;c.message.success=true;o(function(){c.message.success=false},2e3);o(function(){t.go("/")},2e3)},function(e){var t=Object.keys(e).map(function(t){return e[t]});r.formError="Your course has not been added, try again. Possible from duplicate data."});return false};c.resetForm=function(){c.addCoach.$setPristine()};r.beforeResizingImages=function(e){i.show("picturespinner")};r.afterResizingImages=function(e){i.hide("picturespinner")};r.uploadPic=function(e){var t=n.dataUrltoBlob(e,name);var r=new File([t],"1.jpg");e=r;alert("เมื่อ upload หรือเปลี่ยนรูปใหม่เสร็จ ต้องทำการ submit แบบฟอร์มทั้งหมดที่ปุ่ม Submit ด้านล่างสุดบรรทัดสุดท้ายด้วยทุกครั้ง\nEverytime you finish upload or change the new picture. Please submit the whole form via the button beneath last line");Promise.resolve(s).then(function(e){return e}).then(function(t){e.upload=n.upload({url:"https://matchthecoach.s3.amazonaws.com",method:"POST",data:{key:"coaches/"+d,AWSAccessKeyId:t.s3AccessKeyId,acl:"public-read",policy:t.s3Policy,signature:t.s3Signature,"Content-Type":e.type!=""?e.type:"image/png",filename:r.name,file:e}})}).then(function(){e.upload.then(function(e){o(function(){c.result=e.data})},function(e){if(e.status>0)c.errorMsg=e.status+":"+e.data},function(e){c.progress=Math.min(100,parseInt(100*e.loaded/e.total))})})};function p(){return e.allCats().success(function(e){c.data={cat:e}}).error(function(e){c.message="Sorry, something's gone wrong"})}p()}})();(function(){angular.module("mtcApp").component("navigation",{restrict:"EA",templateUrl:"/common/navigationAndfooter/navigation.template.html",controller:"loginController",controllerAs:"lgin"})})();(function(){angular.module("mtcApp").component("footerGeneric",{templateUrl:"/common/navigationAndfooter/footerGeneric.template.html"})})();(function(){angular.module("mtcApp").component("landing",{restrict:"EA",templateUrl:"/home/landing.template.html",controller:"loginController",controllerAs:"lgin"})})();(function(){angular.module("mtcApp").controller("SearchBoxController",e);e.$inject=["$state","mtcData","$timeout","$http"];if(window.location.pathname!=="/"){window.location.href="/#"+window.location.pathname}function e(e,t,o,n){var r=this;r.text="";r.onSubmit=function(t){if(r.text!==""){e.go("search",{text:r.text})}};r.searching=function(e){return n.get("api/coaches/searchCat",{params:{text:e}}).then(function(e){return e.data})};a();function a(){return t.allCats().success(function(e){r.data={cat:e}}).error(function(e){r.message="Sorry, something's gone wrong"})}r.addModel=function(e){r.text=e}}})();(function(){angular.module("mtcApp").component("searchbox",{restrict:"E",templateUrl:"/common/searchbox/searchbox.template.html",bindings:{text:"<"},controller:"SearchBoxController",controllerAs:"vm"})})();(function(){angular.module("mtcApp").factory("awsPolicy",e);e.$inject=["$http","$log"];function e(e,t){var o=function(){return e.get("/api/awsPolicy").then(function(e){return e.data})};return{getSign:o}}})();(function(){angular.module("mtcApp").controller("loginController",e);e.$inject=["authService","$translate","$rootScope","$scope","$state","$timeout","$window"];function e(e,t,o,n,r,a,i){var c=this;c.authService=e;c.goLogin=function(){if(r.current.name==="/"){e.login()}else{alert("Please sign in from main page");r.go("/");i.location.reload()}};c.changeLanguage=function(e){t.use(e)};c.getSubscription=o.isSubscribed;c.serviceSubscription=o.authService.userSubscription;c.isAuthenticated=o.isAuthenticated;c.localStorageSubscription=localStorage.getItem("subscription");a(function(){c.getSubscription=o.isSubscribed},1e3);o.$on("userProfileSet",function(e,t){c.isAuthenticated=o.isAuthenticated;c.profile=t});o.$on("subscriptionSet",function(e,t){a(function(){c.getSubscription=o.isSubscribed},1e3)});var s=localStorage.getItem("profile");if(s){c.profile=angular.fromJson(s)}var u=new Auth0Lock("2m8hbwYC8UdyjITdKGDptrRvF6BXweY7","royyak.auth0.com");u.on("authenticated",function(e){u.getProfile(e.idToken,function(t,o){if(t){console.log(t);return}if(o){localStorage.setItem("id_token",e.idToken);localStorage.setItem("profile",JSON.stringify(profile))}return})});c.addCoach=function(){var e=localStorage.getItem("subscription");if(e=="false"){alert($filter("translate")("PROFILE.ALERT"));r.go("subscription")}else if(e=="true"){r.go("addCoach")}};c.becomeCoach=function(){if(o.isAuthenticated===false){e.login()}else if(o.isAuthenticated===true){r.go("profile.bio")}}}})();